<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
		<style>
		body {
			width:100%;
		}

		#movies {
			display:inline-block;
			width:40%;
		}

		#trailer {
			display:inline-block;
			width: 58%;
			vertical-align:top;

		}

		header {
			background-color:black;
			height:60px;
			width:100%;
			padding:12px 20px 0 20px;
		}

		body{margin:0;background-color:whitesmoke;}
		ul { list-style-type: none; overflow-y:scroll; height: 500px; }
		</style>
		<link rel="stylesheet" type="text/css" href="CloudComputing/assets/css/normalize.css">
		<script src="https://apis.google.com/js/api.js"></script>
		<script type="text/javascript">
			    var xhttp = new XMLHttpRequest();

			    document.onclick = function(e) {   //when the document body is clicked
				    if (window.event) {
				        e = event.srcElement;           //assign the element clicked to e (IE 6-8)
				    }
				    else {
				        e = e.target;                   //assign the element clicked to e
				    }

				    if (e.className && e.className.indexOf('searchTrailer') != -1) {
				        gapi.client.load('youtube', 'v3', () => {

			             searchTr(e.id)
			          });
				    }
				}

				function start(searchKey) {
			        // Initializes the client with the API key and the Translate API.
			        gapi.client.init({
			          'apiKey': 'APIKEY  '
			        }).then(function() {
			          // Executes an API request, and returns a Promise.
			          // The method name `language.translations.list` comes from the API discovery.
			          console.log("succes")
			        }), function(reason) {
			          console.log('Error: ' + reason.result.error.message);
			        };
			      };
			    gapi.load('client', start);

			    function searchTr(searchKey) {
			      var keyq = searchKey + " trailer"
		          var request = gapi.client.youtube.search.list({
		            q: keyq,
		            part: 'snippet'
		          });

		          request.execute(function(response) {
		            var str = JSON.stringify(response.result.items[0]);

		            document.getElementById('YoutubeVideo').src = "https://www.youtube.com/embed/"+response.result.items[0].id.videoId + "?autoplay=1";
		            console.log(response.result.items[0])
		          });
		        }

			    search = function() {
			    	var input_key = document.getElementById('movie').value;
			    	var url = "https://api.themoviedb.org/3/discover/movie?with_genres="

			    	switch(input_key) {
			    		case "drama":
			    			url+="18"
			    			break;
			    		case "action":
			    			url+="28"
			    			break
			    		case "animation":
			    			url+="16"
			    			break
			    		case "comedy":
			    			url+="35"
			    			break
			    		case "family":
			    			url+="10751"
			    			break
			    		case "western":
			    			url+="37"
			    			break;
			    		case "mistery":
			    			url+="9648"
			    			break
			    		default:
			    			break;
			    	}

			    	url += "&api_key=API_KEY"
			    	xhttp.open("GET", url, false);
			    	xhttp.send()
			    	var result = JSON.parse( xhttp.response);
			    	results = result.results
			    	results_titles = []
			    	for (var i=0; i<results.length; i++) {
			    		results_titles.push(results[i].title)
			    	}
			    	var childNodes = document.getElementById("movies").childNodes
			    	var index = 0
			    	for (var i = 0; i <  childNodes.length; i++)
					{
						if (childNodes[i].nodeType != 1) {
					       continue;
					    }

						childNodes[i].innerHTML = results_titles[index] + "<button class=\'searchTrailer btn btn-default\' id=\'"+results_titles[index] +"\'>trailer</button>" + "<button class=\'btn btn-default\' id=\'"+results_titles[index] +"-add\'>ADD</button>"
						index++
					}
			    }
		</script>

	</head>
	<body>
		<header>
			<input type="text" id="movie"></input>
	    	<button class="btn" id="send" onclick="search()">Search</button>
		</header>

	    <div id="container"></div>
	    <ul id="movies">
	    	<li></li>
	    	<li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	        <li></li>
	    </ul>
	    <div id="trailer">
	    	<iframe id="YoutubeVideo" width="800" height="500"
			src="https://www.youtube.com/embed/tgbNymZ7vqY">
	    </iframe>
	    </div>
	    <form method="post" action="/sms">
		    <input type="text" name="user[name]">
		    <input type="text" name="user[email]">
		    <input type="submit" value="Submit">
		</form>
	    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	</body>
</html>